"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9603],{95781:function(e,n,t){var r=t(85893);t(67294),n.Z=function(e){var n=e.message;return(0,r.jsx)("div",{className:"absolute top-24 flex flex-row items-center gap-2 rounded-lg bg-warren-other-redText p-4 md:top-0",children:(0,r.jsx)("span",{className:"text-sm text-white",children:n})})}},89603:function(e,n,t){t.d(n,{Z:function(){return useWarrenConversation}});var r=t(11010),a=t(72253),o=t(14932),c=t(248),s=t(10092),i=t(5152),u=t.n(i),l=t(80809),d=t(67294),_=t(5055),E=t(86501),v=t(95781),m=t(67582),g=t(30855),C=u()((0,r._)(function(){return(0,s.Jh)(this,function(e){return[2,v.Z]})}),{ssr:!1});function useWarrenConversation(e){var n,t,i,u,v,p=e.conversation,f=e.mode,h=void 0===f?"fast":f,T=(0,m.o)().dataStore.warrenStore,k=(0,g.ZP)(),N=k.onChatResponseEvent,w=k.onRegeneratingClickEvent,G=(0,d.useCallback)((n=(0,r._)(function(e){var n,t,r,i,u,l,v,m,g,f,k,w,G,I,S,M,b,R,y,V;return(0,s.Jh)(this,function(s){switch(s.label){case 0:n=e.message,t=e.previousMessage,r=e.previousMessageIndex,i=e.deleteAfterCurrent,u=e.beforeSend,l=e.afterSend,v=e.regenerate,s.label=1;case 1:if(s.trys.push([1,8,,9]),k=!1,w=p)return[3,3];return k=!0,[4,T.createNewConversation(n.content,n)];case 2:w=s.sent(),T.currentConversation=w,T.conversations=[T.currentConversation].concat((0,c._)(T.conversations)),s.label=3;case 3:if(G=w,k||i||(G=(0,o._)((0,a._)({},w),{messages:(0,c._)(w.messages).concat([n])})),!i)return[3,5];return(I=r)||0===I||(I=G.messages.findIndex(function(e){return e===t})),S=G.messages.slice(0,I),G=(0,o._)((0,a._)({},G),{messages:(0,c._)(S).concat([n])}),[4,T.updateConversation(G)];case 4:G=s.sent(),s.label=5;case 5:return T.currentConversation=G,M={messages:G.messages.filter(_.cS),mode:h},u&&u(),T.incrementUsageQueries(),[4,T.sendChatMessage({payload:M,currentConversation:T.currentConversation,regenerate:v})];case 6:return N(((null===(g=(R=(null===(m=(b=s.sent()).messages)||void 0===m?void 0:m.filter(_.Gn))||[])[R.length-1])||void 0===g?void 0:g.content)||"").length,0),l&&l(),y=b||G,[4,T.updateConversation(y)];case 7:return V=s.sent(),(null===(f=T.currentConversation)||void 0===f?void 0:f.id)===(null==V?void 0:V.id)&&(T.currentConversation=V),[3,9];case 8:return s.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[3,9];case 9:return[2]}})}),function(e){return n.apply(this,arguments)}),[T.conversations,p,h]),I=(0,d.useCallback)((t=(0,r._)(function(e){var n,t,r,a,o,i,u,l,v,m,g,p,f,h,k,w,G,I,S;return(0,s.Jh)(this,function(s){switch(s.label){case 0:n=e.questionId,t=e.instrumentId,r=e.fullname,a=e.type,o=e.path,i=e.ticker,u=e.exchange,l=e.exchangeFullName,v=e.text,m=e.beforeSend,g=e.afterSend,p={role:"user",content:v,updatedAt:new Date().toISOString()},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,T.createNewConversation(v,p)];case 2:return f=s.sent(),T.currentConversation=f,T.conversations=[T.currentConversation].concat((0,c._)(T.conversations)),[3,4];case 3:return s.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[2];case 4:return s.trys.push([4,7,,8]),m&&m(),T.incrementUsageQueries(),[4,T.sendQueryTemplateChatMessage({id:n,ticker:i,name:r,pair_id:t,exchange_full_name:l,type:a,path:o,exchange:u},T.currentConversation)];case 5:return N(((null===(k=(G=(null===(h=(w=s.sent()).messages)||void 0===h?void 0:h.filter(_.Gn))||[])[G.length-1])||void 0===k?void 0:k.content)||"").length,0),g&&g(),I=w||f,[4,T.updateConversation(I)];case 6:return S=s.sent(),T.currentConversation=S,[3,8];case 7:return s.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[3,8];case 8:return[2]}})}),function(e){return t.apply(this,arguments)}),[p]),S=(0,d.useCallback)((i=(0,r._)(function(e){var n,t,r,a,o,i,u,l,v,m,g,p;return(0,s.Jh)(this,function(s){switch(s.label){case 0:n=e.id,t=e.text,r=e.beforeSend,a=e.afterSend,o={role:"user",content:t,updatedAt:new Date().toISOString()},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,T.createNewConversation(t,o)];case 2:return i=s.sent(),T.currentConversation=i,T.conversations=[T.currentConversation].concat((0,c._)(T.conversations)),[3,4];case 3:return s.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[2];case 4:return s.trys.push([4,7,,8]),r&&r(),[4,T.sendCachedChatMessage(n,T.currentConversation)];case 5:return N(((null===(l=(m=(null===(u=(v=s.sent()).messages)||void 0===u?void 0:u.filter(_.Gn))||[])[m.length-1])||void 0===l?void 0:l.content)||"").length,0),a&&a(),g=v||i,[4,T.updateConversation(g)];case 6:return p=s.sent(),T.currentConversation=p,[3,8];case 7:return s.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[3,8];case 8:return[2]}})}),function(e){return i.apply(this,arguments)}),[p]),M=(0,d.useCallback)((0,r._)(function(){var e,n;return(0,s.Jh)(this,function(t){return w(),(null==p?void 0:p.messages)&&((n=p.messages.filter(_.Z$)).length>0&&(e=n[n.length-1]),e&&G({message:e,previousMessage:e,deleteAfterCurrent:!0,regenerate:!0})),[2]})}),[p]);return{handleSend:G,handleSendQueryTemplate:I,handleSendCached:S,handleRegenerate:M,onPositiveSendFeedback:(0,d.useCallback)((u=(0,r._)(function(e){var n,t;return(0,s.Jh)(this,function(r){switch(r.label){case 0:if(!p)return[2];n=l.y.POSITIVE,t={messages:p.messages.filter(_.cS),rating:n,user_comment:"",mode:"fast",message_id:null==e?void 0:e.id},r.label=1;case 1:return r.trys.push([1,4,,5]),[4,T.sendFeedback(t)];case 2:return r.sent(),T.updateMessageFeedback(e,p,n),[4,T.updateConversation(p)];case 3:return r.sent(),[3,5];case 4:return r.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[3,5];case 5:return[2]}})}),function(e){return u.apply(this,arguments)}),[p]),onNegativeSendFeedback:(0,d.useCallback)((v=(0,r._)(function(e,n){var t,r,a,o;return(0,s.Jh)(this,function(c){switch(c.label){case 0:if(!p||!e)return[2];t=n.rating,r=n.user_comment,a=n.tags,o={messages:p.messages.filter(_.cS),rating:t,user_comment:r,mode:"fast",message_id:null==e?void 0:e.id,tags:a},c.label=1;case 1:return c.trys.push([1,4,,5]),[4,T.sendFeedback(o)];case 2:return c.sent(),T.updateMessageFeedback(e,p,t),[4,T.updateConversation(p)];case 3:return c.sent(),[3,5];case 4:return c.sent(),E.default.custom(function(){return d.createElement(C,{message:"Something went wrong, please try again later"})},{duration:1e3}),[3,5];case 5:return[2]}})}),function(e,n){return v.apply(this,arguments)}),[p])}}},80809:function(e,n,t){t.d(n,{y:function(){return o}}),(r=a||(a={})).POSITIVE="POSITIVE",r.NEGATIVE="NEGATIVE";var r,a,o={POSITIVE:"positive",NEGATIVE:"negative"}},30855:function(e,n,t){t.d(n,{A3:function(){return c},DQ:function(){return C},PQ:function(){return i},uP:function(){return s}});var r,a,o,c,s,i,u=t(72253),l=t(71485),d=t(67582),_=t(63106),E=t(79727),v=t(23279),m=t.n(v),g=t(67294),C={EDIT:"warren:editQuestionEdit",SEND:"warren:editQuestionSend",CANCEL:"warren:editQuestionCancel"};(r=c||(c={})).EDIT="warren:chatHistoryEdit_clicked",r.SHARE="warren:chatHistoryShare_clicked",r.DELETE="warren:chatHistoryDelete_clicked",r.ACCEPT_DELETE="warren:chatHistoryConfirmDelete_clicked",r.CANCEL_DELETE="warren:chatHistoryCancelDelete_clicked",(a=s||(s={})).DELETE="warren:chatDeleteFolderIcon_clicked",a.ACCEPT="warren:chatDeleteFolderYes_clicked",a.CANCEL="warren:chatDeleteFolderNo_clicked",(o=i||(i={})).DELETE="warren:promptDeleteFolderIcon_clicked",o.ACCEPT="warren:promptDeleteFolderYes_clicked",o.CANCEL="warren:promptDeleteFolderNo_clicked",n.ZP=function(){var e=(0,d.o)().dataStore.warrenStore,n=(0,l.FG)().sendTagManagerEvent,t={event_cd_description1:"warren_platform",event_cd_value1:e.mobileOS===_.Ty.ANDROID?"android":e.mobileOS===_.Ty.IOS?"iOS":e.source===E.Eq.WORKSTATION?"work station":"warren page"};return{onSendClickEvent:function(e,r){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:send_clicked",event_cd_description2:"thread hit number",event_cd_value2:r,event_cd_description3:"text sent by user",event_cd_value3:null==e?void 0:e.slice(0,255)},t))},onEditQuestionClickEvent:function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:e},t))},onNewChatClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:newChat_clicked"},t))},onNewPromptClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:newPrompt_clicked"},t))},onStopGeneratingClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:stopGenerating_clicked"},t))},onRegeneratingClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:regenerate_clicked"},t))},onFeedbackClickEvent:function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:e?"warren:like_clicked":"warren:dislike_clicked"},t))},onNegativeSubmitClickEvent:function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:submitDislike_clicked",event_cd_description2:"user additional feedback",event_cd_value2:null==e?void 0:e.slice(0,255)},t))},onChatResponseEvent:function(e,r){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:responseFromServer_recieved",event_cd_description2:"response length",event_cd_value2:e,event_cd_description3:"response model",event_cd_value3:"gpt3.5turbo",event_cd_description4:"limit counter",event_cd_value4:r},t))},onPromptClickEvent:function(e,r,a){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:choosePrompt_clicked",event_cd_description2:"prompt source",event_cd_value2:e,event_cd_description3:"prompt type",event_cd_value3:r,event_cd_description4:"prompt name",event_cd_value4:a},t))},onSubmitPromptEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:submitPrompt_clicked"},t))},onEditPromptEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:editPromptSubmit_clicked"},t))},onOpenSharedChatEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:openSharedChat_clicked"},t))},onExampleClickEvent:function(e,r){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:useExample_clicked",event_cd_description2:"example type",event_cd_value2:e?"page related example":"general question",event_cd_description3:"example name",event_cd_value3:r},t))},onLightModeClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:settingsLightMode_clicked"},t))},onDarkModeClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:settingsDarkMode_clicked"},t))},onNewChatFolderClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:chatCreateFolder_clicked"},t))},onRenameChatFolderClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:chatRenameFolder_clicked"},t))},onDeleteChatFolderClickEvent:function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:e},t))},onCopyClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:copyResponse_clicked"},t))},onSearchEvent:(0,g.useCallback)(m()(function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:search",event_cd_description2:"search term",event_cd_value2:e},t))},500),[]),onChatMoveFolderEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:chatMoveToFolder_clicked"},t))},onLoadChatFolderEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:chatHistoryLoadChat_clicked"},t))},onChatHistoryActionClickEvent:function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:e},t))},onPromptMoveFolderEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:promptMoveToFolder_clicked"},t))},onNewPromptFolderClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:promptCreateFolder_clicked"},t))},onRenamePromptFolderClickEvent:function(){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:"warren:promptRenameFolder_clicked"},t))},onDeletePromptFolderClickEvent:function(e){n(l.eg.GTM_GENERIC_EVENT,(0,u._)({event_name:e},t))}}}}}]);